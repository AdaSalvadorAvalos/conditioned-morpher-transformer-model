<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMT</title>
    <style>
        body {
            font-family: 'Computer Modern', 'Times New Roman', serif;
            margin: 0;
            padding: 20px;
            background: white;
            color: #000;
            line-height: 1.3;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
        }
        
        .title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #000;
        }
        
        .architecture {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .stage {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .stage-label {
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
        }
        
        .flow {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .parallel-flow {
            display: flex;
            justify-content: space-around;
            gap: 40px;
            margin: 20px 0;
        }
        
        .stream {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }
        
        .stream-label {
            font-weight: bold;
            font-size: 12px;
            color: #666;
            border-bottom: 1px solid #ccc;
            padding-bottom: 2px;
        }
        
        /* Standard ML Component Shapes */
        .component {
            padding: 8px 12px;
            text-align: center;
            font-size: 10px;
            min-width: 80px;
            border: 2px solid;
            position: relative;
        }
        
        .rect { border-radius: 2px; }
        .rounded { border-radius: 8px; }
        .circle { 
            border-radius: 50%; 
            width: 60px; 
            height: 60px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            min-width: 60px;
        }
        
        /* Standard Academic ML Colors */
        .input { background: #e8f5e8; border-color: #4caf50; } /* Light green - standard for inputs */
        .embedding { background: #fff3e0; border-color: #ff9800; } /* Light orange - standard for embeddings */
        .processing { background: #e3f2fd; border-color: #2196f3; } /* Light blue - standard for processing */
        .attention { background: #f3e5f5; border-color: #9c27b0; } /* Light purple - standard for attention */
        .conditioning { background: #fff8e1; border-color: #ffc107; } /* Light amber/yellow - standard for conditioning */
        .film { background: #ffecb3; border-color: #ff8f00; } /* Warmer orange/amber for FiLM */
        .latent { background: #f5f5f5; border-color: #757575; } /* Light gray - standard for latent space */
        .output { background: #ffebee; border-color: #f44336; } /* Light red - standard for outputs */
        .operation { background: #f9f9f9; border-color: #9e9e9e; } /* Light gray - standard for operations */

        .arrow {
            font-size: 14px;
            color: #333;
            font-weight: bold;
            text-align: center;
        }
        
        .tensor-info {
            font-size: 8px;
            color: #666;
            font-style: italic;
        }
        
        .morph-section {
            background: #f9f9f9;
            border: 2px solid #9e9e9e;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
        
        .morph-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .morph-equation {
            font-size: 12px;
            font-family: 'Computer Modern', monospace;
            background: white;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .film-detail {
            background: #fff3e0;
            border: 2px solid #ef6c00;
            border-radius: 6px;
            padding: 10px;
            margin: 8px 0;
        }
        
        .film-title {
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 5px;
            text-align: center;
            color: #ef6c00;
        }
        
        .film-components {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin-top: 30px;
            padding: 15px;
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .legend-title {
            grid-column: 1/-1;
            font-weight: bold;
            font-size: 12px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 10px;
        }
        
        .legend-shape {
            width: 20px;
            height: 15px;
            border: 2px solid;
            flex-shrink: 0;
        }
        
        .decoder-detail {
            background: #f5f5f5;
            border: 1px solid #999;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .multi-head {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .head {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 3px;
            padding: 4px 8px;
            font-size: 9px;
            min-width: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Conditioned Morpher Transformer model (CMT)</div>
        
        <div class="architecture">
            <!-- Input Stage -->
            <div class="stage">
                <div class="stage-label">INPUT STAGE</div>
                <div class="parallel-flow">
                    <div class="stream">
                        <div class="stream-label">Source Domain</div>
                        <div class="component input rect">Tokenized Audio Sequence<br><span class="tensor-info">[B, K, L]</span></div>
                        <div class="component input rect">Style Conditioning<br><span class="tensor-info">[B, 400]</span></div>
                        <div class="component input rect">BPM Conditioning<br><span class="tensor-info">[B, 1]</span></div>
                        <div class="arrow">↓</div> <!-- arrow specific to source stream -->

                    </div>
                    <div class="stream">
                        <div class="stream-label">Target Domain</div>
                        <div class="component input rect">Tokenized Audio Sequence<br><span class="tensor-info">[B, K, L]</span></div>
                        <div class="component input rect">Style Conditioning<br><span class="tensor-info">[B, 400]</span></div>
                        <div class="component input rect">BPM Conditioning<br><span class="tensor-info">[B, 1]</span></div>
                        <div class="arrow">↓</div> <!-- arrow specific to target stream -->

                    </div>
                </div>
            </div>
                        
            <!-- Embedding Stage -->
<div class="stage">
    <div class="stage-label">EMBEDDING STAGE</div>
    <div class="parallel-flow">
        <div class="stream">
            <div class="flow">
                <div class="component embedding rounded">Embedding Layer (X9)<br><span class="tensor-info">V→\(d_{model}\)</span></div>
                <div class="arrow">→</div>
                <div class="component processing circle">Mean Pooling<br><span class="tensor-info"></span></div>
                <div class="arrow">→</div>
                <div class="component processing rounded">PosEnc<br><span class="tensor-info">[B,L,\(d_{model}\)]</span></div>
            </div>
            <div class="flow">
                <div class="component conditioning rect">Style Embedding<br><span class="tensor-info">400→\(d_{model}\)</span></div>
                <div class="component conditioning rect">BPM Embedding<br><span class="tensor-info">1→\(d_{model}\)</span></div>
            </div>
            <div class="arrow">↓</div>
        </div>
        <div class="stream">
            <div class="flow">
                <div class="component embedding rounded">Embedding Layer (X9)<br><span class="tensor-info">V→\(d_{model}\)</span></div>
                <div class="arrow">→</div>
                <div class="component processing circle">Mean Pooling<br><span class="tensor-info"></span></div>
                <div class="arrow">→</div>
                <div class="component processing rounded">PosEnc<br><span class="tensor-info">[B,L,\(d_{model}\)]</span></div>
            </div>
            <div class="flow">
                <div class="component conditioning rect">Style Embedding<br><span class="tensor-info">400→\(d_{model}\)</span></div>
                <div class="component conditioning rect">BPM Embedding<br><span class="tensor-info">1→\(d_{model}\)</span></div>
            </div>
            <div class="arrow">↓</div>
        </div>
    </div>
</div>


<!-- Encoder Stage -->
<div class="stage">
    <div class="stage-label">ENCODER STAGE</div>
    <div class="parallel-flow">
        <div class="stream">
            <div style="border: 2px dashed #666; padding: 15px; border-radius: 6px;">
                <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">Transformer Encoder (×6)</div>
                <div class="flow" style="flex-direction: column; gap: 8px;">
                    <div class="component attention rounded">Multi-Head Self-Attention<br><span class="tensor-info">h=8</span></div>
                    <div class="component operation rounded">Add & Norm<br><span class="tensor-info">Residual + LayerNorm</span></div>
                    <div class="film-detail">
                        <div class="film-title">FiLM Modulation</div>
                        <div class="film-components">
                            <div class="component film rounded" style="font-size: 9px;">Style γ, β</div>
                            <div class="component film rounded" style="font-size: 9px;">BPM γ, β</div>
                        </div>
                    </div>
                    <div class="component processing rounded">Feed Forward<br><span class="tensor-info">\(d_{model}\)→\(d_{ff}\)→\(d_{model}\)</span></div>
                    <div class="component operation rounded">Add & Norm<br><span class="tensor-info">Residual + LayerNorm</span></div>
                    <div class="film-detail">
                        <div class="film-title">FiLM Modulation</div>
                        <div class="film-components">
                            <div class="component film rounded" style="font-size: 9px;">Style γ, β</div>
                            <div class="component film rounded" style="font-size: 9px;">BPM γ, β</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="arrow">↓</div>
            <div class="component latent rect">Source Representation<br><span class="tensor-info">[B, L, \(d_{model}\)]</span></div>
            <div class="arrow">↓</div>
        </div>
        <div class="stream">
            <div style="border: 2px dashed #666; padding: 15px; border-radius: 6px;">
                <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">Transformer Encoder (×6)</div>
                <div class="flow" style="flex-direction: column; gap: 8px;">
                    <div class="component attention rounded">Multi-Head Self-Attention<br><span class="tensor-info">h=8</span></div>
                    <div class="component operation rounded">Add & Norm<br><span class="tensor-info">Residual + LayerNorm</span></div>
                    <div class="film-detail">
                        <div class="film-title">FiLM Modulation</div>
                        <div class="film-components">
                            <div class="component film rounded" style="font-size: 9px;">Style γ, β</div>
                            <div class="component film rounded" style="font-size: 9px;">BPM γ, β</div>
                        </div>
                    </div>
                    <div class="component processing rounded">Feed Forward<br><span class="tensor-info">\(d_{model}\)→\(d_{ff}\)→\(d_{model}\)</span></div>
                    <div class="component operation rounded">Add & Norm<br><span class="tensor-info">Residual + LayerNorm</span></div>
                    <div class="film-detail">
                        <div class="film-title">FiLM Modulation</div>
                        <div class="film-components">
                            <div class="component film rounded" style="font-size: 9px;">Style γ, β</div>
                            <div class="component film rounded" style="font-size: 9px;">BPM γ, β</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="arrow">↓</div>
            <div class="component latent rect">Target Representation<br><span class="tensor-info">[B, L,\(d_{model}\)]</span></div>
            <div class="arrow">↓</div>

        </div>
    </div>
</div>

            <!-- Morphing Operation -->
<div class="stage">
     <div class="stage-label">LATENT INTERPOLATION STAGE</div>
        <div class="parallel-flow">
            <div class="morph-section">
                <div class="morph-title">Latent Interpolation Layer</div>
                <div class="morph-equation"><span>\(z_{morph} = (1-\alpha) z_{s} + \alpha z_{t}\)</span></div>
                <div class="tensor-info" style="margin-top: 8px;">α ∈ [0,1] controls morphing ratio</div>
            </div>
        </div>
    </div>
</div>

<div style="display:flex; justify-content:center; margin:20px 0;">
    <div class="arrow">↓</div>
</div>



            <!-- Decoder Stage -->
            <div class="stage">
                <div class="stage-label">DECODER STAGE</div>
                <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                    <div class="flow">
                        <div class="component latent rect">Target Representation<br><span class="tensor-info">[B, L,\(d_{model}\)]</span></div>
                        <div class="component conditioning rect">Style Embedding<br><span class="tensor-info">[B, \(d_{model}\)]</span></div>
                        <div class="component conditioning rect">BPM Embedding<br><span class="tensor-info">[B, \(d_{model}\)]</span></div>
                    </div>
                    
                    <div class="arrow">↓</div>
                    
                    <div class="decoder-detail">
                        <div style="text-align: center; font-weight: bold; margin-bottom: 15px;">Transformer Decoder (×6)</div>
                        <div class="flow" style="flex-direction: column; gap: 10px;">
                            <div class="component processing rect">Decoder Input + PosEnc<br><span class="tensor-info">[B, \(L_t\), \(d_{model}\)]</span></div>
                            <div class="component attention rounded">Masked Self-Attention<br><span class="tensor-info">Causal Mask</span></div>
                            <div class="component operation rounded">Add & Norm<br><span class="tensor-info">Residual + LayerNorm</span></div>
                            <div class="film-detail">
                                <div class="film-title">FiLM Modulation</div>
                                <div class="film-components">
                                    <div class="component film rounded" style="font-size: 9px;">Style γ, β</div>
                                    <div class="component film rounded" style="font-size: 9px;">BPM γ, β</div>
                                </div>
                            </div>
                            <div class="component attention rounded">Cross-Attention<br><span class="tensor-info">Q: decoder, K&V: memory</span></div>
                            <div class="component operation rounded">Add & Norm<br><span class="tensor-info">Residual + LayerNorm</span></div>
                            <div class="film-detail">
                                <div class="film-title">FiLM Modulation</div>
                                <div class="film-components">
                                    <div class="component film rounded" style="font-size: 9px;">Style γ, β</div>
                                    <div class="component film rounded" style="font-size: 9px;">BPM γ, β</div>
                                </div>
                            </div>
                            <div class="component processing rounded">Feed Forward<br><span class="tensor-info">\(d_{model}\)→\(d_{ff}\)→\(d_{model}\)</span></div>
                            <div class="component operation rounded">Add & Norm<br><span class="tensor-info">Residual + LayerNorm</span></div>
                            <div class="film-detail">
                                <div class="film-title">FiLM Modulation</div>
                                <div class="film-components">
                                    <div class="component film rounded" style="font-size: 9px;">Style γ, β</div>
                                    <div class="component film rounded" style="font-size: 9px;">BPM γ, β</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="arrow">↓</div>
                    
                    <div class="multi-head">
                        <div class="head">Head 1</div>
                        <div class="head">Head 2</div>
                        <div class="head">Head 3</div>
                        <div class="head">...</div>
                        <div class="head">Head 9</div>
                    </div>
                    <div class="tensor-info">9 output heads: Linear(\(d_{model}\) → V) per DAC codebook</div>
                    
                    <div class="arrow">↓</div>
                    
                    <div class="component output rect">Predicted Logits for Each Codebook<br><span class="tensor-info">[B, K, \(L_t\), V]</span></div>
                </div>
            </div>
        </div>
        
        <!-- Legend -->
        <div class="legend">
            <div class="legend-title">Standard ML Architecture Components</div>
            <div class="legend-item">
                <div class="legend-shape input rect"></div>
                <span>Input Data</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape embedding rounded"></div>
                <span>Embedding Layers</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape processing rounded"></div>
                <span>Processing/Transforms</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape processing circle"></div>
                <span>Element-wise Ops</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape attention rounded"></div>
                <span>Attention Mechanisms</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape conditioning rect"></div>
                <span>Conditioning</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape film rounded"></div>
                <span>FiLM Modulation</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape latent rect"></div>
                <span>Latent Representations</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape output rect"></div>
                <span>Output</span>
            </div>
        </div>

        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
        
<!-- Key Equations -->
<!-- <div style="margin-top: 25px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 4px;">
    <div style="font-weight: bold; margin-bottom: 10px; text-align: center;">Key Mathematical Operations</div>
    <div style="display: flex; flex-wrap: wrap; justify-content: space-between; font-size: 11px; font-family: 'Computer Modern', monospace; line-height: 1.6;">
        <div style="width: 48%;"><strong>FiLM Conditioning:</strong> <span>\(y(x_{emb},c) = \gamma(c) \odot x_{emb} + \beta(c)\)</span></div>
        <div style="width: 48%;"><strong>Combined FiLM:</strong> <span>\(x_{\text{out}} = x_{emb} + (\text{FiLM}_{\sigma}(x_{emb},c_\sigma)-x_{emb}) + (\text{FiLM}_{\text{b}}(x_{emb},c_b) - x_{emb})\)</span></div>
        <div style="width: 48%; margin-top: 10px;"><strong>Latent Interpolation:</strong> <span>\(z_{morph} = (1-\alpha) z_{s} + \alpha z_{t}\)</span></div>
        <div style="width: 48%; margin-top: 10px;"><strong>Multi-Head Attention:</strong> <span>\(\text{Attention}(Q,K,V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V\)</span> (here, K refers to keys, not the number of codebooks)</div>
    </div>
</div> -->

        <!-- Legend -->
<div style="margin-top: 15px; padding: 10px; background: #f1f1f1; border: 1px solid #ccc; border-radius: 4px; font-size: 11px; font-family: 'Computer Modern', monospace;">
    <strong>Legend:</strong>
    <div style="font-size: 11px; font-family: 'Computer Modern', monospace; line-height: 1.4;">
        <strong>B</strong>: batch size &nbsp;|&nbsp; 
        <strong>L</strong>: maximum sequence length (input) &nbsp;|&nbsp;
        <strong>\(L_t\)</strong>: maximum sequence length (target) &nbsp;|&nbsp;  
        <strong>t</strong>: target codes &nbsp;|&nbsp; 
        <strong>K</strong>: number of codebooks &nbsp;|&nbsp; 
        <strong>\(d_{model}\)</strong>: transformer embedding dimension &nbsp;|&nbsp; 
        <strong>\(d_{ff}\)</strong>: feed-forward network hidden dimension &nbsp;|&nbsp; 
        <strong>s</strong>: source codes &nbsp;|&nbsp; 
        <strong>h</strong>: number of attention heads &nbsp;|&nbsp; 
        <strong>V</strong>: vocabulary size of each codebook
    </div>
    
</div>

        
    </div>
</body>
</html>